pragma circom 2.1.7;

include "../../circomlib/circuits/comparators.circom";
include "./num_func.circom";

function inverse_two_frbn254() {
    return 10944121435919637611123202872628637544274182200208017171849102093287904247809;
}

template GetDomainElement(precomputed_generators_size) {
    signal input pow;
    signal input precomputed_generators[precomputed_generators_size];
    signal output out;

    component pow_bit = Num2Bits(precomputed_generators_size);
    pow_bit.in <== pow;

    signal x_out[precomputed_generators_size];
    signal tmp[precomputed_generators_size - 1];
    for (var i = 0; i < precomputed_generators_size; i++) {
        if (i == 0) {
            x_out[i] <== pow_bit.out[i] * precomputed_generators[i] + (1 - pow_bit.out[i]);
        } else {
            tmp[i - 1] <== pow_bit.out[i] * precomputed_generators[i] + (1 - pow_bit.out[i]);
            x_out[i] <== x_out[i-1] * tmp[i - 1];
        }
    }

    out <== x_out[precomputed_generators_size-1];
}

template GetDomainElementInverse(precomputed_generators_size) {
    signal input pow;
    signal input precomputed_generators[precomputed_generators_size];
    signal output out;

    signal domain_size <== two_pow(precomputed_generators_size);

    component is_zero = IsZero();
    is_zero.in <== pow;

    component get_domain_element = GetDomainElement(precomputed_generators_size);
    get_domain_element.pow <==  (1 - is_zero.out) * (domain_size - pow);
    for (var i = 0; i < precomputed_generators_size; i++) {
        get_domain_element.precomputed_generators[i] <== precomputed_generators[i];
    }

    out <== get_domain_element.out;
}

function get_mimc_d() {
    return [1, 31, 19, 23, 13, 17, 7, 11];
}

function get_mimc_k() {
    return [
        1328790040692576325258580129229001772890358018148159309458854770206210226319,
        5880579452694111398038816184147859226105113334752339841727721355533812240766,
        20720298443502290991238122024134905464046321666717822276762466456909938589925,
        1225226870221330534236667639124645733305013293285183755126644184226480421877,
        20666036155664624504225370085928507504727714640082865046624161456603976254683,
        3157378951250542999615166081535380702386454288648567478932678638099344481774,
        3824431963826485634246943850162533602092322575684471569309295730899186901733,
        3900560118787540994812717948312874165432127573083167111328504761327136204245,
        10511357378835416088058103305478756848527487105346166937825890899192817151974,
        9216609037631332483475566766682816259141139707956492485686989423421915111501,
        17959228123173091607284135425246569038937854216618225562934671378308991630508,
        4132853558118393645279045988505499215807873927635112403546887246451842858339,
        9971805513131090791393133818878305317344809701477712843539205385745831468361,
        12811761702796728625944889301894116737033927669019276877967140957246132363738,
        2789025224015300257839790461429706036081946287139494400131563041659158707562,
        20232669164132864300034433243288022469586755105499583785797690375955912608970,
        3291224373631121044329490581231830695947197367519693156881409373306486393784,
        6335432452091687734588808942215200846220756622673335397816430058795770537505,
        7714430039115243211524513834352304452637774076278670182999303417135516691997,
        9091445405081142888022319590426362965002667535379391103731282332208594524938,
        12975163765616160123019631150030650042418112740841856087692046287057918238401,
        5271152870933478354043938344648515054642712914952533461684620354847911598140,
        2049081609791175953885763486932661167150731844371730458379740134182521029399,
        14691160052844725609754618131765837398889149151901700621494919041307782850474,
        8460337858155396212281934427245117237472983561204869655833478440235841902350,
        3449393684227722919495511378120776998591162196374629026211643047933792231588,
        6290168043864621889873367577126765468700812288055722241015272116913674134379,
        16632886053766829939064837633452490532000180257587332513308513398805482751716,
        11495601597988156145975767675628432155118422638674433965844396061309810337298,
        12320675373129284059790092349017430223645596315923360617310896957554359005346,
        137778142136299707834044257779958277932910827438469330080815671266804855619,
        12476579587687091064756166969939351354926044050366630713497673456404142708386,
        16968220764707953094875191287789082724088332673686963581935394101651668705028,
        2365331455625578076643299235348178025369059796286315471044938060300558150297,
        20015834126780465643032016813690221300210631829962966311355105651647573368819,
        7222452608279279943325931859684744483883901031623176994094183351851372778201,
        10005907898816837897228559781807002756948779222042615074915905836526202084808,
        9566165115851636287646338185063730203672228418380966150122823563719747322850,
        21679372553777497345696761834475276283412740101174404439736022159996900750155,
        21540767670393797316732741059316016286999845107320041292029347805343013644947,
        19448078957374823712035072383726489718176934312002664750520998162115653702,
        11253685686584554126042034358751123142858535526227805133473875471130255134049,
        2987625881993511076877271811063186003492263177463008147278536834548944448450,
        2111523984329516428032593925401017620661776327571280824940959003524066972617,
        20336032262028750397593296838392656880760898408709967390189619013722076023559,
        13050640409144247402275573777773816650436439868294042806485554664181465527022,
        15580082547269996683989673186100217669859776629749198881059297031648541583778,
        5176079424037977226415808804917754162352225486672108836000670455799435504246,
        21201718717566939424828925854655609504328655931879746189205576605686865207424,
        12416842119284618242132628498191158016725240736168668778143624916931888310559,
        13750229730229146065943983551830555609845609125658963393310897964220722355155,
        8397449472053284509671819626640651127994790608077744651296463112339789225260,
        9887780430041127520915740715769450861045190718890671962164466183172158292857,
        18091704777409501336383726839422147547059780976280911699395539520011139303486,
        4351703269524182891231548028967258847523814658328741543539450463120883016429,
        5521547840877175753416770849445823814689115193726679334123192001975552091179,
        10595482880072875543238144816962143390828929551441334660993386349600333188911,
        485226198136163500299466069227793247449919883351701678769459631581707377600,
        1420431952274728708348387099689439315426254926551604304775733276816143488458,
        18614400235935513476150849140505504284583481608172446861900301106495604000898,
        4907728441158193247940843678792280768762076779534279939815077417385537349906,
        17957239345931709347845092429244070241236174049823477952110612237490074033778,
        8162378081581873917660214083624311251357667181430581831440385882081975390238,
        16316931636592210620115258785770052282247395230752543997779110707349257761315,
        16551594099258107129506019106719610174738702946989991706084923694640025050291,
        14791990461974138310087262128741023978262530984094788414981358627764125524242,
        9539077229839388658858632690573243567014766106726408722213895669444503785049,
        15362543805401954087854019513950817562918909102914337263652775016247432542169,
        9778678063928346354075707335047209629316599119513218153566401482382398269354,
        15301176332966408062244088983398215503828876762372214818081318288020201134603,
        15976687265770420561519400369334487715812207355568646017988095222334200879865,
        14947528623207522131324802772672612463315695583686950568033203279025717285998,
        11959290082559178718956132662140964098798514117209932112480334833912830106419,
        14248820842494572912771292578380368940118882679122197365887517406698926442181,
        17693892099837341288748226399781424742297758448609512860667797374746540257524,
        9458140265370442318905560353453451468153863353444153477550116475771587272783,
        4988034406074115232126287503863274422254967710254938243946106322507968646039,
        11247782727122162532251220668573309476298977381089479999725764601661118072812,
        17661487553195792728313805960348943977127937000356622406057779119425740837752,
        18979158223783115072575179791223872787258783751689615475765818003396352523408,
        4842438671091838373933967317861627938630698011065741541054667308513724836454,
        20680364355351217800875336720692786872238534707158442314132690758185466379813,
        16425956153474262986921638014220759136970219068340768808757143385532778857446,
        4914171237956986539612429507544851589052815278254418165023038878269539345314,
        4020952832285724398896623880328528454515309610698015418370299704638880982831,
        21647823473126874217020089611667979623239800431537146281477271032672409913135,
        4873551614117328091831291386118552310708533503893093127816118726800162812069,
        19808618391305734552417869976905432886726023337031759166492555017318936891132,
        16515293624166492763397492078129142071987359761587718464250958001467843319304,
        14698135706189841869473005356227505448138600717262350962071779035605111925856,
        1507410352315190511059623398935640127787452795751045859857161086801163453004,
        3437528772002889534527959989565227169456007209230969961558090158172437143234,
        10643394550352422542248711136678382448741326519894917081479349477312649722781,
        3998447390291603109877397692385900394696008440982781676651566303213110784896,
        21016598812869406823871829718011727216315999979138486460840943307218339394555,
        1787763947141600293516915484094153486148663050449246292952077450442074810795,
        3817569459259167357564443701332591703098886886614619108216969954985719810041,
        13585112093444223126283557756257290506434559092806676490606065676714568721753,
        20596666260043552351235820097151651194678131994774980835861995596911689996285,
        14650623479564014092411199583790584275504446601669264422308285138780294544490,
        18485478347820561735027947011909227245681722060227611128361942509906257860007,
        10287637024647669320878849554720408119478353950714431380786018827732762320080,
        4130694138976358655364813728414966785159288647012800185407687596620084500554,
        2615884619014462736703331167193623309001023964265538657029523698192599370515,
        3153437159551980059643223702920270744872189612293497131988907442748498323628,
        12189385276566350007474256059955620913061950844900971735468882334583663159860,
        18431146978398310271406223056902088634748039996334589124180719386275038975861,
        16581582548218672283680380174407148359792244412025541656508380989620414069193,
        15815532167061641686311177827140271862792248799086099959544137060723994696078,
        220898174751369042624316788601725332391242637033501587666842897840965478507,
        18262350364989225570415460680062468311227397015604776513952837484828713778701,
        16089935984569812672704853332378734001075252634514409339013679714920779397602,
        18849914719838346583081915966326043934685504514815692231359184205315715443254,
        12776104175376075609178595853044066288359860785604332856143921479322647485917,
        14197024302377655133670807817441052341951057603833144653766645294958159455397,
        15824998266396445448373853269125151001470917324089346781872812249607999416427,
        2242806540614954832239929721664690252779636498945118548741003158512811001071,
        6712019970508148771306729070512728499451104182493919647718379869643216937058,
        7755770115426064802919285144116810368579897047708201906258274268514648537874,
        12496748968610806963469315110305613347853121768043612805377198399570489639782,
        1537824009445177850048963801961548734245016149474607408245365573623979979127,
        7883644837842453020288285204537156542943775491528055708824410576621909201760,
        4116935369397586512936451499994436682134607561943776869230553553615120375733,
        14325083400825648359377760169015551102008982567241096560289038785880500063410,
        4391342143910208198598884929087924595935372562431920620266806427594805561860,
        4578303044025767770442112608061039179638679131968742736952671830761121166773,
        17928985297461149629944114556421830641778588421086006757929554576409056785033,
        2362304854319438970616772160716990055927257129577859015771930231768394653767
    ];
}

